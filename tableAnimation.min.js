/* jQuery sorted voting system */
/* Provides automatic sorting and voting on elements
 * Â© Pez Cuckow 2012+
 * email@pezcuckow.com
 * Please keep attribution, including use of modified or selected code.
 * Twitter: @Pezmc
 */
function Animator(t){this.setOptions(t)
var e=this
this.timerDelegate=function(){e.onTimerEvent()},this.subjects=[],this.target=0,this.state=0,this.lastTime=null}function NumericalStyleSubject(t,e,o,n,r){this.els=Animator.makeArray(t),"opacity"==e&&window.ActiveXObject?this.property="filter":this.property=Animator.camelize(e),this.from=parseFloat(o),this.to=parseFloat(n),this.units=null!=r?r:"px"}function ColorStyleSubject(t,e,o,n){this.els=Animator.makeArray(t),this.property=Animator.camelize(e),this.to=this.expandColor(n),this.from=this.expandColor(o),this.origFrom=o,this.origTo=n}function DiscreteStyleSubject(t,e,o,n,r){this.els=Animator.makeArray(t),this.property=Animator.camelize(e),this.from=o,this.to=n,this.threshold=r||.5}function CSSStyleSubject(t,e,o){if(t=Animator.makeArray(t),this.subjects=[],0!=t.length){var n,r,i
if(o)i=this.parseStyle(e,t[0]),r=this.parseStyle(o,t[0])
else{r=this.parseStyle(e,t[0]),i={}
for(n in r)i[n]=CSSStyleSubject.getStyle(t[0],n)}var n
for(n in i)i[n]==r[n]&&(delete i[n],delete r[n])
var n,a,s,l,c,u
for(n in i){var h=String(i[n]),p=String(r[n])
if(null!=r[n]){if(c=ColorStyleSubject.parseColor(h))u=ColorStyleSubject.parseColor(p),l=ColorStyleSubject
else if(h.match(CSSStyleSubject.numericalRe)&&p.match(CSSStyleSubject.numericalRe)){c=parseFloat(h),u=parseFloat(p),l=NumericalStyleSubject,s=CSSStyleSubject.numericalRe.exec(h)
var d=CSSStyleSubject.numericalRe.exec(p)
a=null!=s[1]?s[1]:null!=d[1]?d[1]:d}else{if(!h.match(CSSStyleSubject.discreteRe)||!p.match(CSSStyleSubject.discreteRe)){window.DEBUG&&alert("Unrecognised format for value of "+n+": '"+i[n]+"'")
continue}c=h,u=p,l=DiscreteStyleSubject,a=0}this.subjects[this.subjects.length]=new l(t,n,c,u,a)}else window.DEBUG&&alert("No to style provided for '"+n+'"')}}}function AnimatorChain(t,e){this.animators=t,this.setOptions(e)
for(var o=0;o<this.animators.length;o++)this.listenTo(this.animators[o])
this.forwards=!1,this.current=0}function Accordion(t){this.setOptions(t)
var e,o=this.options.initialSection
this.options.rememberance&&(e=document.location.hash.substring(1)),this.rememberanceTexts=[],this.ans=[]
for(var n=this,r=0;r<this.options.sections.length;r++){var i=this.options.sections[r],a=new Animator(this.options.animatorOptions),s=this.options.from+this.options.shift*r,l=this.options.to+this.options.shift*r
a.addSubject(new NumericalStyleSubject(i,this.options.property,s,l,this.options.units)),a.jumpTo(0)
var c=this.options.getActivator(i)
c.index=r,c.onclick=function(){n.show(this.index)},this.ans[this.ans.length]=a,this.rememberanceTexts[r]=c.innerHTML.replace(/\s/g,""),this.rememberanceTexts[r]===e&&(o=r)}this.show(o)}!function(){function t(t){var o=this.length,n=Math.floor(o/2)
return t||(t=function(t,e){return e>t?-1:t==e?0:1}),2>o?this:e(this.slice(0,n).msort(t),this.slice(n,o).msort(t),t)}function e(t,e,o){for(var n=[];t.length>0||e.length>0;)t.length>0&&e.length>0?o(t[0],e[0])<=0?(n.push(t[0]),t=t.slice(1)):(n.push(e[0]),e=e.slice(1)):t.length>0?(n.push(t[0]),t=t.slice(1)):e.length>0&&(n.push(e[0]),e=e.slice(1))
return n}Array.prototype.msort=jQuery.fn.msort=t}(),jQuery.fn.sortElements=function(t){var e=[].msort
return function(o,n){n=n||function(){return this}
var r=this.map(function(){var t=n.call(this),e=t.parentNode,o=e.insertBefore(document.createTextNode(""),t.nextSibling)
return function(){if(e===this)throw new Error("You can't sort elements if any one is a descendant of another.")
e.insertBefore(this,o),e.removeChild(o)}})
return t(e.call(this,o)).each(function(t){r[t].call(n.call(this))})}}(jQuery),function(t){var e={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},o=function(r){var i=t(r).css("backgroundColor")
return 0===i.indexOf("rgba")||"transparent"===i?r.parentNode!=document?o(r.parentNode):"#FFFFFF":(i in e?i=e[i]:-1==i.indexOf("#")&&(i=n(i)),i)},n=function(e){var o="#"
return t.each(e.substring(4).split(","),function(e,n){var r=(1*t.trim(n.replace(")",""))).toString(16)
o+=1==r.length?"0"+r:r}),o},r=function(e){var o=0
return t.each(e.animationSettings,function(t,e){o=Math.min(e.left,o)}),o},i={onComplete:function(){},duration:[1e3,0,700,0,500],extractIdFromCell:function(e){return t.trim(t(e).html())},animationSettings:{up:{left:-25,backgroundColor:"#004400"},down:{left:25,backgroundColor:"#550000"},fresh:{left:0,backgroundColor:"#FFFF33"},drop:{left:0,backgroundColor:"#550055"}}},a=function(e){e=t(e)
var o=e.css("padding-top")+" "+e.css("padding-right")+" "+e.css("padding-bottom")+" "+e.css("padding-left")
return e.css({padding:0}),o},s=function(e){if(e||(e={}),"number"==typeof e.duration){var o=e.duration/3
e.duration=[o,0,o,0,o]}return t.extend(!0,{},i,e)}
t.fn.rankingTableUpdate=function(e,n){var i=this,l=t(e),c=this[0]
e=l[0],l.hide()
var u=i.parent()
l.parent()[0]!==u[0]&&u.append(e),n=s(n)
var h=c.tBodies[0],p=e.tBodies[0],d=p.rows.length,m=c.tHead.rows[0].cells.length,f=o(c.parentNode),S=0,b=new Array
constantColumns={},updatingColumns={},noUpdatingColumns=!0,t(c.tHead.rows[0].cells).each(function(e,o){o=t(o),o.hasClass("anim:position")?(b.push(e),updatingColumns[e]=!0):o.hasClass("anim:id")?(S=e,constantColumns[e]=!0):o.hasClass("anim:constant")?constantColumns[e]=!0:(updatingColumns[e]=!0,noUpdatingColumns=!1)})
var g={},y={}
t(h.rows).each(function(t,e){g[n.extractIdFromCell(e.cells[S])]=t}),t(p.rows).each(function(t,e){y[n.extractIdFromCell(e.cells[S])]=t})
var v={},j={},w={},C={},A={},k=0,F=0,x=0
if(t.each(g,function(t,e){if(t in y){var o=y[t],n=e-o
n>0?(v[e]=o,k=Math.max(n,k)):0>n?(j[e]=o,F=Math.max(0-F,F)):(A[e]=!0,x++),delete y[t]}else C[e]=!0}),t.each(y,function(t,e){w["x"+e]=!0}),x===d&&noUpdatingColumns)return void setTimeout(function(){i.replaceWith(l),l.show(),n.onComplete()},10)
var T=i.height(),N=l.height(),I=r(n)
i.css({position:"relative",left:0-I}),i.wrap(t("<div />",{css:{height:T,overflow:"hidden",position:"relative",left:I}})),t(h.rows).each(function(e,o){t.each(o.cells,function(o,n){var r=t("<div/>",{"class":"moveable",css:{position:"relative",padding:a(n)}})
r.data("row",e),r.data("column",o),t(n).wrapInner(r)})})
var O=d-h.rows.length
if(O>0){var M=t("<tr/>")
M.append(t("<td/>",{css:{color:f,backgroundColor:f}}).html("a"))
for(var E=1;m>E;E++)M.append(t("<td/>",{css:{backgroundColor:f}}))
for(i.append(M);O>0;){var R=M.clone()
i.append(R),O--}}t.each(w,function(e){e=1*e.substring(1)
var o=t(p.rows[e]).clone()
i.append(o),t(o[0].cells).each(function(o,r){var i=t("<div />",{"class":"moveable",css:{position:"relative",padding:a(r),backgroundColor:n.animationSettings.fresh.backgroundColor,left:n.animationSettings.fresh.left}})
i.data("row","x"+e),i.data("column",o),t(r).wrapInner(i)})})
var D=new Animator({onComplete:function(){t(c.parentNode).replaceWith(l),l.show(),n.onComplete()},duration:n.duration[4]}),P=new Animator({onComplete:function(){setTimeout(function(){D.play()},n.duration[3])},duration:n.duration[2]}),z=[],B=new Animator({onComplete:function(){t.each(z,function(e,o){t(o[0]).html(o[1])}),setTimeout(function(){P.play()},n.duration[1])},duration:n.duration[0]})
return N>T?B.addSubject(new NumericalStyleSubject(c.parentNode,"height",T,N)):T>N&&D.addSubject(new NumericalStyleSubject(c.parentNode,"height",T,N)),i.find("div.moveable").each(function(e,r){var i,a=r.parentNode,s=t(r).data("row"),l=t(r).data("column")
if(!(s in A||s in w)){var c=o(a)
t(r).css("backgroundColor",c),t(r.parentNode).css("backgroundColor",f)}if(s in v){var u=n.animationSettings.up,d=(s-v[s],u.backgroundColor),m=u.left
i=p.rows[v[s]].cells[l],B.addSubject(new NumericalStyleSubject(r,"left",0,m)),B.addSubject(new ColorStyleSubject(r,"background-color",c,d))
var S=t(h.rows[v[s]]).position().top-t(h.rows[s]).position().top
P.addSubject(new NumericalStyleSubject(r,"top",0,S)),D.addSubject(new NumericalStyleSubject(r,"left",m,0)),D.addSubject(new ColorStyleSubject(r,"background-color",d,o(i)))}else if(s in j){var u=n.animationSettings.down,d=(j[s]-s,u.backgroundColor),m=u.left
i=p.rows[j[s]].cells[l],B.addSubject(new NumericalStyleSubject(r,"left",0,m)),B.addSubject(new ColorStyleSubject(r,"background-color",c,d)),t(r.parentNode).css("backgroundColor",f)
var S=t(h.rows[j[s]]).position().top-t(h.rows[s]).position().top
P.addSubject(new NumericalStyleSubject(r,"top",0,S)),D.addSubject(new NumericalStyleSubject(r,"left",m,0)),D.addSubject(new ColorStyleSubject(r,"background-color",d,o(i)))}else if(s in C){var u=n.animationSettings.drop,d=u.backgroundColor,m=u.left
t(r.parentNode).css("backgroundColor",f),B.addSubject(new NumericalStyleSubject(r,"left",0,m)),B.addSubject(new ColorStyleSubject(r,"background-color",c,d))
var S=N-t(h.rows[s]).position().top
P.addSubject(new NumericalStyleSubject(r,"top",0,S)),P.addSubject(new NumericalStyleSubject(r,"opacity",1,0,""))}else if(s in w){s=1*s.substring(1)
var u=n.animationSettings.fresh
i=p.rows[s].cells[l]
var S=t(h.rows[s]).position().top-t(r.parentNode).position().top
P.addSubject(new NumericalStyleSubject(r,"top",0,S)),D.addSubject(new ColorStyleSubject(r,"background-color",u.backgroundColor,o(i))),D.addSubject(new NumericalStyleSubject(r,"left",u.left,0))}else i=p.rows[s].cells[l]
if(l in updatingColumns&&(-1!=t.inArray(l,b)||!(s in A))){t(r).wrapInner(t("<div />",{"class":"innerWrapper"}))
var g=t(r).find(".innerWrapper")[0]
B.addSubject(new NumericalStyleSubject(g,"opacity",1,0,"")),null!=i&&(D.addSubject(new NumericalStyleSubject(g,"opacity",0,1,"")),z.push([g,t(i).html()]))}}),B.play(),this}}(jQuery),Animator.prototype={setOptions:function(t){this.options=Animator.applyDefaults({interval:20,duration:400,onComplete:function(){},onStep:function(){},transition:Animator.tx.easeInOut},t)},seekTo:function(t){this.seekFromTo(this.state,t)},seekFromTo:function(t,e){this.target=Math.max(0,Math.min(1,e)),this.state=Math.max(0,Math.min(1,t)),this.lastTime=(new Date).getTime(),this.intervalId||(this.intervalId=window.setInterval(this.timerDelegate,this.options.interval))},jumpTo:function(t){this.target=this.state=Math.max(0,Math.min(1,t)),this.propagate()},toggle:function(){this.seekTo(1-this.target)},addSubject:function(t){return this.subjects[this.subjects.length]=t,this},clearSubjects:function(){this.subjects=[]},propagate:function(){for(var t=this.options.transition(this.state),e=0;e<this.subjects.length;e++)this.subjects[e].setState?this.subjects[e].setState(t):this.subjects[e](t)},onTimerEvent:function(){var t=(new Date).getTime(),e=t-this.lastTime
this.lastTime=t
var o=e/this.options.duration*(this.state<this.target?1:-1)
Math.abs(o)>=Math.abs(this.state-this.target)?this.state=this.target:this.state+=o
try{this.propagate()}finally{this.options.onStep.call(this),this.target==this.state&&(window.clearInterval(this.intervalId),this.intervalId=null,this.options.onComplete.call(this))}},play:function(){this.seekFromTo(0,1)},reverse:function(){this.seekFromTo(1,0)},inspect:function(){for(var t="#<Animator:\n",e=0;e<this.subjects.length;e++)t+=this.subjects[e].inspect()
return t+=">"}},Animator.applyDefaults=function(t,e){e=e||{}
var o,n={}
for(o in t)n[o]=void 0!==e[o]?e[o]:t[o]
return n},Animator.makeArray=function(t){if(null==t)return[]
if(!t.length)return[t]
for(var e=[],o=0;o<t.length;o++)e[o]=t[o]
return e},Animator.camelize=function(t){var e=t.split("-")
if(1==e.length)return e[0]
for(var o=0==t.indexOf("-")?e[0].charAt(0).toUpperCase()+e[0].substring(1):e[0],n=1,r=e.length;r>n;n++){var i=e[n]
o+=i.charAt(0).toUpperCase()+i.substring(1)}return o},Animator.apply=function(t,e,o){return e instanceof Array?new Animator(o).addSubject(new CSSStyleSubject(t,e[0],e[1])):new Animator(o).addSubject(new CSSStyleSubject(t,e))},Animator.makeEaseIn=function(t){return function(e){return Math.pow(e,2*t)}},Animator.makeEaseOut=function(t){return function(e){return 1-Math.pow(1-e,2*t)}},Animator.makeElastic=function(t){return function(e){return e=Animator.tx.easeInOut(e),(1-Math.cos(e*Math.PI*t))*(1-e)+e}},Animator.makeADSR=function(t,e,o,n){return null==n&&(n=.5),function(r){return t>r?r/t:e>r?1-(r-t)/(e-t)*(1-n):o>r?n:n*(1-(r-o)/(1-o))}},Animator.makeBounce=function(t){var e=Animator.makeElastic(t)
return function(t){return t=e(t),1>=t?t:2-t}},Animator.tx={easeInOut:function(t){return-Math.cos(t*Math.PI)/2+.5},linear:function(t){return t},easeIn:Animator.makeEaseIn(1.5),easeOut:Animator.makeEaseOut(1.5),strongEaseIn:Animator.makeEaseIn(2.5),strongEaseOut:Animator.makeEaseOut(2.5),elastic:Animator.makeElastic(1),veryElastic:Animator.makeElastic(3),bouncy:Animator.makeBounce(1),veryBouncy:Animator.makeBounce(3)},NumericalStyleSubject.prototype={setState:function(t){for(var e=this.getStyle(t),o=("opacity"==this.property&&0==t?"hidden":"",0),n=0;n<this.els.length;n++){try{this.els[n].style[this.property]=e}catch(r){if("fontWeight"!=this.property)throw r}if(o++>20)return}},getStyle:function(t){return t=this.from+(this.to-this.from)*t,"filter"==this.property?"alpha(opacity="+Math.round(100*t)+")":"opacity"==this.property?t:Math.round(t)+this.units},inspect:function(){return"	"+this.property+"("+this.from+this.units+" to "+this.to+this.units+")\n"}},ColorStyleSubject.prototype={expandColor:function(t){var e,o,n,r
return(e=ColorStyleSubject.parseColor(t))?(o=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16),[o,n,r]):void(window.DEBUG&&alert("Invalid colour: '"+t+"'"))},getValueForState:function(t,e){return Math.round(this.from[t]+(this.to[t]-this.from[t])*e)},setState:function(t){for(var e="#"+ColorStyleSubject.toColorPart(this.getValueForState(0,t))+ColorStyleSubject.toColorPart(this.getValueForState(1,t))+ColorStyleSubject.toColorPart(this.getValueForState(2,t)),o=0;o<this.els.length;o++)this.els[o].style[this.property]=e},inspect:function(){return"	"+this.property+"("+this.origFrom+" to "+this.origTo+")\n"}},ColorStyleSubject.parseColor=function(t){var e,o="#"
if(e=ColorStyleSubject.parseColor.rgbRe.exec(t)){for(var n,r=1;3>=r;r++)n=Math.max(0,Math.min(255,parseInt(e[r]))),o+=ColorStyleSubject.toColorPart(n)
return o}if(e=ColorStyleSubject.parseColor.hexRe.exec(t)){if(3==e[1].length){for(var r=0;3>r;r++)o+=e[1].charAt(r)+e[1].charAt(r)
return o}return"#"+e[1]}return!1},ColorStyleSubject.toColorPart=function(t){t>255&&(t=255)
var e=t.toString(16)
return 16>t?"0"+e:e},ColorStyleSubject.parseColor.rgbRe=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i,ColorStyleSubject.parseColor.hexRe=/^\#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,DiscreteStyleSubject.prototype={setState:function(t){for(var e=0;e<this.els.length;e++)this.els[e].style[this.property]=t<=this.threshold?this.from:this.to},inspect:function(){return"	"+this.property+"("+this.from+" to "+this.to+" @ "+this.threshold+")\n"}},CSSStyleSubject.prototype={parseStyle:function(t,e){var o={}
if(-1!=t.indexOf(":"))for(var n=t.split(";"),r=0;r<n.length;r++){var i=CSSStyleSubject.ruleRe.exec(n[r])
i&&(o[i[1]]=i[2])}else{var a,s,l
l=e.className,e.className=t
for(var r=0;r<CSSStyleSubject.cssProperties.length;r++)a=CSSStyleSubject.cssProperties[r],s=CSSStyleSubject.getStyle(e,a),null!=s&&(o[a]=s)
e.className=l}return o},setState:function(t){for(var e=0;e<this.subjects.length;e++)this.subjects[e].setState(t)},inspect:function(){for(var t="",e=0;e<this.subjects.length;e++)t+=this.subjects[e].inspect()
return t}},CSSStyleSubject.getStyle=function(t,e){var o
return document.defaultView&&document.defaultView.getComputedStyle&&(o=document.defaultView.getComputedStyle(t,"").getPropertyValue(e))?o:(e=Animator.camelize(e),t.currentStyle&&(o=t.currentStyle[e]),o||t.style[e])},CSSStyleSubject.ruleRe=/^\s*([a-zA-Z\-]+)\s*:\s*(\S(.+\S)?)\s*$/,CSSStyleSubject.numericalRe=/^-?\d+(?:\.\d+)?(%|[a-zA-Z]{2})?$/,CSSStyleSubject.discreteRe=/^\w+$/,CSSStyleSubject.cssProperties=["azimuth","background","background-attachment","background-color","background-image","background-position","background-repeat","border-collapse","border-color","border-spacing","border-style","border-top","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-style","border-right-style","border-bottom-style","border-left-style","border-top-width","border-right-width","border-bottom-width","border-left-width","border-width","bottom","clear","clip","color","content","cursor","direction","display","elevation","empty-cells","css-float","font","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","height","left","letter-spacing","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-top","margin-right","margin-bottom","margin-left","max-height","max-width","min-height","min-width","orphans","outline","outline-color","outline-style","outline-width","overflow","padding","padding-top","padding-right","padding-bottom","padding-left","pause","position","right","size","table-layout","text-align","text-decoration","text-indent","text-shadow","text-transform","top","vertical-align","visibility","white-space","width","word-spacing","z-index","opacity","outline-offset","overflow-x","overflow-y"],AnimatorChain.prototype={setOptions:function(t){this.options=Animator.applyDefaults({resetOnPlay:!0},t)},play:function(){if(this.forwards=!0,this.current=-1,this.options.resetOnPlay)for(var t=0;t<this.animators.length;t++)this.animators[t].jumpTo(0)
this.advance()},reverse:function(){if(this.forwards=!1,this.current=this.animators.length,this.options.resetOnPlay)for(var t=0;t<this.animators.length;t++)this.animators[t].jumpTo(1)
this.advance()},toggle:function(){this.forwards?this.seekTo(0):this.seekTo(1)},listenTo:function(t){var e=t.options.onComplete,o=this
t.options.onComplete=function(){e&&e.call(t),o.advance()}},advance:function(){if(this.forwards){if(null==this.animators[this.current+1])return
this.current++,this.animators[this.current].play()}else{if(null==this.animators[this.current-1])return
this.current--,this.animators[this.current].reverse()}},seekTo:function(t){0>=t?(this.forwards=!1,this.animators[this.current].seekTo(0)):(this.forwards=!0,this.animators[this.current].seekTo(1))}},Accordion.prototype={setOptions:function(t){this.options=Object.extend({sections:null,getActivator:function(t){return document.getElementById(t.getAttribute("activator"))},shift:0,initialSection:0,rememberance:!0,animatorOptions:{}},t||{})},show:function(t){for(var e=0;e<this.ans.length;e++)this.ans[e].seekTo(e>t?1:0)
this.options.rememberance&&(document.location.hash=this.rememberanceTexts[t])}}
